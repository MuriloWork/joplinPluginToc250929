- Fluxo de Geração do Sumário (TOC)
    - Este fluxo é iniciado manualmente pelo usuário através de um comando.
    - 1. O usuário executa o comando para criar/atualizar o sumário na nota ativa.
    - 2. `index.ts` recebe a chamada do comando.
    - 3. `noteSync.js` é usado para ler o conteúdo atual e completo da nota.
    - 4. O conteúdo markdown é passado para o `parser.js`, que extrai todos os títulos (nível, texto).
    - 5. Com a lista de títulos, uma nova lista de links em formato markdown é gerada. O `slug.js` cria os links de âncora (ex: `[Título](#título)`).
    - 6. `patcher.js` pega o corpo original da nota e o novo sumário em markdown, e insere ou substitui o sumário antigo de forma inteligente (procurando por um marcador como `<!-- TOC -->` ou um sumário anterior).
    - 7. `noteSync.js` salva o corpo da nota modificado de volta no Joplin.
- Fluxo de Renderização das Seções Recolhíveis
    - Este fluxo acontece automaticamente toda vez que o Joplin renderiza a visualização de uma nota.
    - 1. O Joplin inicia a renderização do markdown.
    - 2. O nosso `ContentScript` (`content_scripts/sectionHandler.js`), registrado como um `MarkdownItPlugin`, é ativado.
    - 3. O plugin sobrescreve as regras de renderização padrão para títulos (`heading_open`, `heading_close`).
    - 4. Ao encontrar um título, em vez de renderizar apenas `<h1>`, ele o envolve em tags `<details>` e `<summary>`.
    - 5. A lógica do `sectioner.js` é usada para garantir que todo o conteúdo abaixo de um título fique dentro da sua respectiva tag `<details>`, respeitando a hierarquia de títulos.
    - 6. O script também verifica se o texto do título no markdown original contém a palavra-chave `open`. Se contiver, ele adiciona o atributo `open` à tag `<details>` (`<details open>`), fazendo com que a seção já apareça aberta.
- Fluxo de Persistência do Estado de Abertura (Toggle)
    - Este fluxo salva o estado (aberto/fechado) de uma seção quando o usuário clica nela.
    - 1. O usuário clica em um `<summary>` na nota renderizada, o que abre ou fecha a seção.
    - 2. Um pequeno script Javascript, também injetado pelo `ContentScript`, detecta esse evento de clique.
    - 3. O script identifica o título que foi clicado e seu novo estado (aberto ou fechado).
    - 4. Ele envia uma mensagem para o plugin principal via `postMessage` (ex: `{ command: 'toggleState', slug: 'titulo-clicado', isOpen: true }`).
    - 5. `index.ts` recebe a mensagem.
    - 6. Usando `patcher.js` e `noteSync.js`, ele localiza a linha do título correspondente no markdown da nota.
    - 7. Ele adiciona ou remove a palavra-chave ` open` no final da linha do título.
    - 8. `noteSync.js` salva a nota com a alteração.